FROM node:10.12.0-alpine

LABEL maintainer="NHS Digital Delivery Centre,  Team-Grads"

ARG REQUEST_HOST
ARG WORK_DIR=/visitorpwa

COPY . $WORK_DIR/.

WORKDIR $WORK_DIR

RUN apk -q update && apk -q upgrade \
 && apk -q add curl \
 && apk -q add bash \
 && apk -q add bash-completion \
 #install node packages
 && npm install -g http-server \
 #purge cache
 && rm -rf /var/cache/apk/* \
 # run install node build dependencies
 && npm install \
 #build dist
 && npm run build \
 #clean up node build dependencies
 && rm -rf node_modules

HEALTHCHECK --interval=1m30s --timeout=10s --retries=10 \
     CMD /bin/bash healthcheck.sh


EXPOSE $PORT

CMD ["/bin/bash", "start.sh"]
